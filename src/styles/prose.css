@layer base {
	.prose {
		max-width: var(--prose-width);
		margin-inline: auto;
		font-family: var(--font-article-body);
		line-height: var(--line-height-relaxed);
		color: var(--color-text);
	}

	.prose p {
		margin-bottom: var(--space-6);
		text-wrap: pretty;
	}

	.prose p:last-child {
		margin-bottom: 0;
	}

	.prose a {
		color: var(--color-primary);
		text-decoration: underline;
		text-underline-offset: var(--text-underline-offset-normal);
		text-decoration-thickness: var(--text-decoration-thickness-thin);
		transition: text-decoration-thickness var(--motion-fast) var(--motion-ease);
	}

	.prose a:hover {
		text-decoration-thickness: var(--text-decoration-thickness-normal);
	}

	.prose h2 {
		font-family: var(--font-article-title);
		font-size: var(--type-4);
		font-weight: var(--font-weight-heading);
		line-height: var(--line-height-snug);
		letter-spacing: var(--letter-spacing-tight);
		color: var(--color-text);
		margin-top: var(--space-10);
		margin-bottom: var(--space-4);
		text-wrap: balance;
	}

	.prose h3 {
		font-family: var(--font-article-title);
		font-size: var(--type-3);
		font-weight: var(--font-weight-heading);
		line-height: var(--line-height-snug);
		color: var(--color-text);
		margin-top: var(--space-8);
		margin-bottom: var(--space-3);
		text-wrap: balance;
	}

	.prose h4 {
		font-family: var(--font-article-title);
		font-size: var(--type-2);
		font-weight: var(--font-weight-heading);
		letter-spacing: var(--letter-spacing-tight);
		margin-top: var(--space-6);
		margin-bottom: var(--space-2);
	}

	.prose h2 + h3 {
		margin-top: var(--space-4);
	}

	.prose h3 + h4 {
		margin-top: var(--space-3);
	}

	.prose ul,
	.prose ol {
		margin-bottom: var(--space-6);
		padding-left: 0; /* Clear default to rely on LI padding and nested structure */
	}

	.prose li > ul,
	.prose li > ol {
		margin-top: var(--space-2);
		margin-bottom: 0;
	}

	.prose ol {
		list-style-type: none;
		counter-reset: list-counter;
		padding-left: 0;
	}

	.prose ul {
		list-style-type: none;
	}

	.prose ul li,
	.prose ol li {
		position: relative;
		padding-left: 1.5em;
	}

	.prose ol li {
		counter-increment: list-counter;
	}

	.prose ol li::before {
		content: counter(list-counter) ".";
		position: absolute;
		left: 0;
		top: 0;
		color: var(--color-primary);
		font-weight: var(--font-weight-bold);
		opacity: 0.8;
		font-feature-settings: "tnum";
	}

	.prose ul li::before {
		content: "";
		position: absolute;
		left: 0;
		top: 0.4em;
		width: 0.9em;
		height: 0.9em;
		background-color: var(--color-primary);
		opacity: 0.8;

		/* 4-point star (Sparkle) */
		-webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 0L14.59 9.41L24 12L14.59 14.59L12 24L9.41 14.59L0 12L9.41 9.41L12 0Z'/%3E%3C/svg%3E");
		mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 0L14.59 9.41L24 12L14.59 14.59L12 24L9.41 14.59L0 12L9.41 9.41L12 0Z'/%3E%3C/svg%3E");

		-webkit-mask-size: contain;
		mask-size: contain;
		-webkit-mask-repeat: no-repeat;
		mask-repeat: no-repeat;
		-webkit-mask-position: center;
		mask-position: center;
	}

	.prose li {
		margin-bottom: var(--space-2);
	}

	.prose li:last-child {
		margin-bottom: 0;
	}

	.prose blockquote {
		font-size: var(--type-2);
		line-height: var(--line-height-relaxed);
		max-width: var(--measure-narrow);
		font-style: italic;
		border-left: 3px solid var(--color-primary);
		margin: var(--space-8) 0;
		padding-left: var(--space-6);
		color: var(--color-muted);
	}

	.prose blockquote p {
		margin-bottom: var(--space-2);
	}

	.prose blockquote p:last-child {
		margin-bottom: 0;
	}

	.prose blockquote ul,
	.prose blockquote ol {
		font-size: var(--type-1);
		margin-top: var(--space-4);
	}

	.prose :not(pre) > code {
		font-family: var(--font-mono);
		font-feature-settings: var(--font-feature-code);
		font-size: 0.85em;
		background-color: var(--color-surface);
		border: 1px solid var(--color-border);
		border-radius: var(--radius-1);
		padding: 0.2em 0.4em;
	}

	.prose mark {
		background-color: color-mix(in srgb, var(--color-primary), transparent 80%);
		color: inherit;
		padding: 0.1em 0.3em;
		border-radius: var(--radius-1);
	}

	.prose img {
		border-radius: var(--radius-2);
		margin: var(--space-8) auto;
		display: block;
		max-width: 100%;
		height: auto;
	}

	.prose table {
		width: 100%;
		border-collapse: collapse;
		margin-bottom: var(--space-8);
		font-size: var(--type-0);
		display: block;
		overflow-x: auto;
		max-width: 100%;
	}

	/* Base striping: Color odd rows (starts with Header if present) */
	.prose tr:nth-child(odd) {
		background-color: color-mix(in srgb, var(--color-action-hover), transparent 50%);
	}

	/* Fix: If header is colored (odd), first body row (odd) must be transparent to alternate */
	.prose thead + tbody tr:nth-child(odd) {
		background-color: transparent;
	}

	/* Then apply color to even body rows to maintain the rhythm */
	.prose thead + tbody tr:nth-child(even) {
		background-color: color-mix(in srgb, var(--color-action-hover), transparent 50%);
	}

	.prose th {
		text-align: left;
		padding: var(--space-3);
		border: 1px solid var(--color-border);
		font-weight: var(--font-weight-heading);
	}

	.prose td {
		padding: var(--space-3);
		border: 1px solid var(--color-border);
	}

	.prose pre {
		margin: var(--space-6) 0;
	}

	/* Task Lists */
	.prose li.task-list-item {
		padding-left: 0;
		list-style-type: none;
		display: flex;
		align-items: flex-start;
		gap: 0.75em;
	}

	.prose li.task-list-item::before {
		content: none;
	}

	.prose .task-list-item input[type="checkbox"] {
		appearance: none;
		-webkit-appearance: none;
		background-color: var(--color-surface);
		margin: 0;
		margin-top: 0.25em; /* Align slightly down to match line-height */
		width: 1.1em;
		height: 1.1em;
		border: 1px solid var(--color-border);
		border-radius: 4px; /* Hardcoded or var(--radius-1) if verified small enough */
		display: grid;
		place-content: center;
		transition: all 120ms ease-in-out;
		cursor: pointer;
		flex-shrink: 0;
	}

	.prose .task-list-item input[type="checkbox"]:hover {
		border-color: var(--color-primary);
	}

	.prose .task-list-item input[type="checkbox"]:checked {
		background-color: var(--color-primary);
		border-color: var(--color-primary);
	}

	.prose .task-list-item input[type="checkbox"]::before {
		content: "";
		width: 0.65em;
		height: 0.65em;
		transform: scale(0);
		transition: 120ms transform ease-in-out;
		background-color: var(--color-surface); /* Checkmark color (inverse of primary) */
		transform-origin: center;
		clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
	}

	.prose .task-list-item input[type="checkbox"]:checked::before {
		transform: scale(1);
	}
}
